function popupMessage(e,t){$().toastmessage("showToast",{text:e.msg,sticky:"success"!=e.result,type:e.result}),t&&jQuery.isFunction(t[e.result])&&t[e.result](e)}function beforeSend(e){e.prop("disabled",!0),e.find("i").removeClass().addClass("fa fa-spinner fa-spin");var t=e.find("span");return t.attr("oldtext",t.text()).text("处理中..."),!0}function afterAction(e){e.prop("disabled",!1),e.find("i").removeClass().addClass("fa fa-floppy-o");var t=e.find("span");return t.text(t.attr("oldtext")),!0}function ajaxSubmitForm(selector){$.validator.unobtrusive.parse(selector),selector.submit(function(e){e.preventDefault();var $this=$(this);$this.valid()&&$.post($this.attr("action"),$this.serialize(),function(data,status){popupMessage(data,{success:function(){var afterSuccess=$this.data("afterSuccess");afterSuccess&&eval(afterSuccess)}})})})}function ajaxBindFileUpload(){Dropzone.autoDiscover=!1,$(".dropzone").dropzone({addedContainer:"#flyArea",dictResponseError:"上传出错",dictFileTooBig:"上传文件大小({{filesize}}MiB) 最大文件大小 ({{maxFilesize}}MiB)",uploadMultiple:!1,maxFilesize:2046,init:function(){this.on("processing",function(){$(".progress").remove(),$("#uploadName").parent().parent().append(function(){return'<div class="progress"><div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;"><span class="sr-only"></span></div></div>'})}),this.on("totaluploadprogress",function(e){$(".progress-bar").css("width",parseInt(e)+"%")}),this.on("success",function(e,t){var a=$("#AttachmentUrl").val();a=a.length>0?a+"|":a;var n=$("#AttachmentName").val();n=n.length>0?n+"|":n,$("#AttachmentUrl").val(a+t.url),$("#AttachmentName").val(n+t.filename);var r=t.filename.length>40?t.filename.substring(0,37)+"...":t.filename;$("#uploadName").append('<p><label title="'+t.filename+'">'+r+'</label> <button type="button" class="btn btn-danger btn-xs btn-delete" onclick="delAttachment(this)">删除</button></p>')}),this.on("error",function(e,t){popupMessage({result:"error",msg:t})})}}),$("#btn-upload").on("click",function(){$(".dropzone").trigger("click"),$(".progress").hide(),$(".progress-bar").attr("style","width:0%")})}function delAttachment(e){var t=$(".btn-delete").index(e),a=$("#AttachmentName").val(),n=$("#AttachmentUrl").val(),r=a.split("|"),o="";$.each(r,function(e,a){t!=e&&(o+=a+"|")});var s=n.split("|"),i="";$.each(s,function(e,a){t!=e&&(i+=a+"|")}),o=o.length>0?o.substring(0,o.lastIndexOf("|")):o,i=i.length>0?i.substring(0,i.lastIndexOf("|")):i,$("#AttachmentName").val(o),$("#AttachmentUrl").val(i),$("#uploadName p:eq("+t+")").remove(),$(".progress").remove()}function insureSummernot(e){e.summernote({height:300,focus:!0,placeholder:"请输入内容",callbacks:{onInit:function(){$node=$(this),$node.summernote("code",$("#"+$node.data("whatever")).val())},onBlur:function(){$node=$(this),$("#"+$node.data("whatever")).val($node.summernote("code"))},onImageUpload:function(e){$node=$(this),summernoteSendFile(e[0],$node)},onImageUploadError:function(){popupMessage({result:"error",msg:"图片上传失败!<br/>保存当前信息，刷新重新来过"})}}})}function summernoteSendFile(e,t){data=new FormData,data.append("file",e);var a=URL.createObjectURL(e);t.summernote("insertImage",a,function(e){$.ajax({url:"/Attachment/UploadFile",data:data,cache:!1,contentType:!1,processData:!1,dataType:"json",type:"POST",success:function(t){e.attr("src",t.showUrl)}})})}function PieChart(e,t,a){var n={series:{pie:{show:!0,innerRadius:.4,label:{show:!0,radius:.75,formatter:function(e,t){return'<div class="donut-label">'+e+"<br/>"+Math.round(t.percent)+"%</div>"}}}},legend:{labelBoxBorderColor:"#ddd",backgroundColor:"none"},grid:{hoverable:!0},colors:["#d9d9d9","#5399D6","#d7ea2b","#348fe2","#49b6d6","#f59c1a","#727cb6","#ff5b57"]};a=$.extend({},n,a),$.plot(e,t,a)}function BarChart(e,t,a){var n={series:{bars:{show:!0,align:"center",barWidth:.5,lineWidth:0,label:{show:!0},fillColor:{colors:[{opacity:.8},{opacity:.8}]}}},legend:{show:!0},grid:{hoverable:!0,borderWidth:0,labelMargin:0,axisMargin:0,minBorderMargin:0},colors:["#d9d9d9","#5399D6","#d7ea2b","#348fe2","#49b6d6","#f59c1a","#727cb6","#ff5b57"]};a=$.extend({},n,a),$.plot(e,t,a),a.isUseTooltip&&(InitialTooltip(),$(e).UseTooltip())}function InitialTooltip(){function e(e,t,a,n){$('<div id="tooltip">'+n+"</div>").css({position:"absolute",display:"none",top:t-40,left:e-120,border:"2px solid "+a,padding:"3px","font-size":"9px","border-radius":"5px","background-color":"#fff","font-family":"Verdana, Arial, Helvetica, Tahoma, sans-serif",opacity:.9}).appendTo("body").fadeIn(200)}var t=null,a=null;$.fn.UseTooltip=function(){$(this).bind("plothover",function(n,r,o){if(o){if(a!=o.series.label||t!=o.dataIndex){t=o.dataIndex,a=o.series.label,$("#tooltip").remove();var s=o.datapoint[0],i=o.datapoint[1],l=o.series.color;e(o.pageX,o.pageY,l,"<strong>"+o.series.xaxis.ticks[s].label+" : "+i+"</strong>")}}else $("#tooltip").remove(),t=null})}}$.ajaxSetup({cache:!1});var ajaxErrorMessage="操作出现异常！",gridOptions={ajax:!0,padding:4,rowCount:[10,20,50],labels:{all:"全部",infos:"显示 {{ctx.start}} 到 {{ctx.end}} 共 {{ctx.total}} 记录",loading:"数据加载中...",noResults:"无可寻记录",refresh:"重新加载",search:"搜索"},css:{iconRefresh:"glyphicon-search"},templates:{footer:'<div id="{{ctx.id}}" class="{{css.footer}}"><div class="row infoBar"><p class="{{css.pagination}}"></p><p class="{{css.infos}}"></p></div></div>'},formatters:{Boolean:function(e,t){return t[e.id]?'<i class="fa fa-check-square-o fa-lg"></i>':""},Current:function(e,t){return"$"+t[e.id]},DateTime:function(e,t){return t[e.id]?moment(t[e.id]).format("YYYY-MM-DD hh:mm:ss"):""},DateOnly:function(e,t){return t[e.id]?moment(t[e.id]).format("YYYY-MM-DD"):""},Email:function(e,t){return"<a href='mailto:"+t[e.id]+"'>"+t[e.id]+"</a>"},Percent:function(e,t){return t[e.id]+" %"},TimeOnly:function(e,t){return t[e.id]},Url:function(e,t){var a=t[e.id],n=a;return"string"!=typeof a&&(n=a.url,a=a.text),"<a href='"+n+"' target='_blank'>"+a+"</a>"}},responseHandler:function(e){return e.errMessage?(alert(e.errMessage),{current:1,rowCount:10,rows:[],total:0}):e},loadDataErrorHandler:function(e){alert(e)}};$(function(){$(".dc-ajax").select2({ajax:{url:"/DistrictCode/Filter",dataType:"json",type:"post",delay:250,data:function(e){return{match:e.term,page:e.page}},processResults:function(e,t){return t.page=t.page||1,{results:e.items,pagination:{more:30*t.page<e.total}}},cache:!1},escapeMarkup:function(e){return e},minimumInputLength:2,templateResult:function(e){return e.loading?e.text:"<adiv class='clearfix'>"+e.name+"<span class='pull-right'>"+e.id+"</span></div>"},templateSelection:function(e){return e.name||e.text},inputTooShort:function(e){var t=e.minimum-e.input.length,a="Please "+t+" or more characters";return a}}),$(".std-ajax").select2({ajax:{url:"/StudentChoose/Filter",dataType:"json",type:"post",delay:250,data:function(e){var t={match:e.term,page:e.page};return getStdAjaxExt&&(t=getStdAjaxExt(t)),t},processResults:function(e,t){return t.page=t.page||1,{results:e.items,pagination:{more:30*t.page<e.total}}},cache:!1},escapeMarkup:function(e){return e},minimumInputLength:1,templateResult:function(e){return e.loading?e.text:"<adiv class='clearfix'>"+e.name+"<span class='pull-right'>"+e.roll+"</span></div>"},templateSelection:function(e){return e.name||e.text},inputTooShort:function(e){var t=e.minimum-e.input.length,a="Please "+t+" or more characters";return a}})}),$(function(){$(document).on("click.bs.modal.data-api",'[data-toggle="ajax-modal"]',function(){var e=$(this),t=e.data("url"),a=$(e.data("target"));$.get(t,function(e){a.html(e).modal({backdrop:"static",keyboard:!1,show:!0})})})}),$(function(){$(".btn-expand").click(function(e){e.preventDefault();var t=$(this).closest(".widget");$("body").hasClass("widget-expand")&&$(t).hasClass("widget-expand")?($("body, .widget").removeClass("widget-expand"),$(".widget").removeAttr("style")):($("body").addClass("widget-expand"),$(this).closest(".widget").addClass("widget-expand")),$(window).trigger("resize")})});