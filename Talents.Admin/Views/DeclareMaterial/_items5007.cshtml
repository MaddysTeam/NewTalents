@{
	var activeItems = ViewBag.DeclareActives as List<DeclareActive>;
	var archievement = ViewBag.DecalreAchievements as List<DeclareAchievement>;
	var jiaoxPingb = activeItems.FindAll(at => at.ActiveKey == DeclareKeys.ZisFaz_JiaoxHuod_JiaoxPingb);
	var xuekMingt = activeItems.FindAll(at => at.ActiveKey == DeclareKeys.PeihJiaoyyGongz_XuekMingt);
	var pingbHuoj = activeItems.FindAll(at => at.ActiveKey == DeclareKeys.ZisFaz_XuesHuod);
	var declareTargetId = Request["declareTargetId"];
}
<!-- 教育教学 -->
<div class="tab-pane fade itmes" id="tab2">

	<!-- WIDGET TABBED CONTENT -->
	<div class="widget">
		<div class="widget-header">
			<h3><i class="fa fa-paperclip"></i>教育教学-教育教学评比 （最多填两项）</h3>
			@if (jiaoxPingb != null && jiaoxPingb.Count < 2)
			{
				<a class="btn btn-warning btn-sm pull-right" data-url="@Url.Action("ZisFaz_JiaoxHuod_JiaoxPingb", "DeclarePop",new { declareTargetId=DeclareTargetIds.XuekDaitr })" data-toggle="ajax-modal" data-target="#firstModal">新增申报</a>
				<a class="btn btn-info btn-sm pull-right" data-url="@Url.Action("DeclareActiveList", "DeclareMaterial",new { itemKey =DeclareKeys.ZisFaz_JiaoxHuod_JiaoxPingb, declareTargetId=declareTargetId})" data-toggle="ajax-modal" data-target="#firstModal">
					历史库
				</a>
			}
		</div>
		<div class="widget-content">
			<div class="table-responsive">
				<table class="table table-condensed table-striped table-hover">
					<thead>
						<tr>
							<th class="width180">时间</th>
							<th class="width180">年级</th>
							<th style="width:500px">工作内容</th>
							<th class="width180">奖项名称、等第</th>
							<th class="width180">参加对象</th>
							<th class="width300">操作</th>
						</tr>
					</thead>
					<tbody>
						@foreach (var item in jiaoxPingb)
						{
							<tr>
								<td>
									@item.Date.ToString("yyyy-MM-dd")
								</td>
								<td>
									@item.Location
								</td>
								<td>
									@item.ContentValue
								</td>
								<td>
									@item.Dynamic2
								</td>
								<td>
									@item.Dynamic1
								</td>
								<td>
									<div class="btn-group pull-right">
										<a class="btn btn-success btn-sm" data-url="@Url.Action("ZisFaz_JiaoxHuod_JiaoxPingb", "DeclarePop",new {id=item.DeclareActiveId, declareTargetId=declareTargetId })" data-toggle="ajax-modal" data-target="#firstModal">编辑</a>
										<a target="_blank" class="btn btn-warning btn-sm  btn-cancelDeclare" data-url="@Url.Action("DeclareActive", "DeclareMaterial", new {id=item.DeclareActiveId, isDeclare=false, declareTargetId = declareTargetId })" href="#">取消申报</a>
										<button class="btn btn-danger btn-sm btn-view" data-toggle="ajax-modal" data-url="@Url.Action("AttachmentsView", "DeclarePop", new { id = item.DeclareActiveId, type = AttachmentsKeys.ZisFaz_JiaoxHuod_JiaoxPingb })" data-target="#firstModal" title="查看附件">查看附件</button>
									</div>
								</td>
							</tr>
						}
					</tbody>
				</table>
			</div>
		</div>
	</div>
	<!-- END WIDGET TABBED CONTENT -->
	<!-- WIDGET TABBED CONTENT -->
	<div class="widget">
		<div class="widget-header">
			<h3><i class="fa fa-paperclip"></i>入职3年青年教师“三个一”基本功展示获奖情况（最多填两项）</h3>
			@if (xuekMingt != null && xuekMingt.Count < 2)
			{
				<a class="btn btn-warning btn-sm pull-right" data-url="@Url.Action("PeihJiaoyyGongz_XuekMingt", "DeclarePop",new { declareTargetId=DeclareTargetIds.XuekDaitr })" data-toggle="ajax-modal" data-target="#firstModal">新增申报</a>
				<a class="btn btn-info btn-sm pull-right" data-url="@Url.Action("DeclareActiveList", "DeclareMaterial",new { itemKey =DeclareKeys.PeihJiaoyyGongz_XuekMingt, declareTargetId=declareTargetId})" data-toggle="ajax-modal" data-target="#firstModal">
					历史库
				</a>
			}
		</div>
		<div class="widget-content">
			<div class="table-responsive">
				<table class="table table-condensed table-striped table-hover">
					<thead>
						<tr>
							<th class="width180">时间</th>
							<th class="width180">年级</th>
							<th class="width180">级别</th>
							<th style="width:500px">工作内容</th>
							<th class="width180">参加对象</th>
							<th class="width240">组织单位、部门/负责人</th>
							<th class="width400">操作</th>
						</tr>
					</thead>
					<tbody>
						@foreach (var item in xuekMingt)
						{
							<tr>
								<td>
									@item.Date.ToString("yyyy-MM-dd")
								</td>
								<td>
									@item.Dynamic2
								</td>
								<td>
									@item.Level
								</td>
								<td>
									@item.ContentValue
								</td>
								<td>
									@item.Dynamic3
								</td>
								<td>
									-
								</td>
								<td>
									<div class="btn-group pull-right">
										<a class="btn btn-success btn-sm" data-url="@Url.Action("PeihJiaoyyGongz_XuekMingt", "DeclarePop",new {id=item.DeclareActiveId, declareTargetId=declareTargetId })" data-toggle="ajax-modal" data-target="#firstModal">编辑</a>
										<a target="_blank" class="btn btn-warning btn-sm  btn-cancelDeclare" data-url="@Url.Action("DeclareActive", "DeclareMaterial", new {id=item.DeclareActiveId, isDeclare=false, declareTargetId = declareTargetId })" href="#">取消申报</a>
										<button class="btn btn-danger btn-sm btn-view" data-toggle="ajax-modal" data-url="@Url.Action("AttachmentsView", "DeclarePop", new { id = item.DeclareActiveId, type = AttachmentsKeys.PeihJiaoyyGongz_XuekMingt })" data-target="#firstModal" title="查看附件">查看附件</button>
									</div>
								</td>
							</tr>
						}
					</tbody>
				</table>
			</div>
		</div>
	</div>
	<!-- END WIDGET TABBED CONTENT -->
	<!-- WIDGET TABBED CONTENT -->
	<div class="widget">
		<div class="widget-header">
			<h3><i class="fa fa-paperclip"></i>近三年校级及以上“其它综合性荣誉”情况（最多填两项）</h3>
			@if (pingbHuoj != null && pingbHuoj.Count < 2)
			{
				<a class="btn btn-warning btn-sm pull-right " data-url="@Url.Action("ZisFaz_XuesHuod", "DeclarePop",new { declareTargetId=DeclareTargetIds.XuekDaitr })" data-toggle="ajax-modal" data-target="#firstModal">新增申报</a>
				<a class="btn btn-info btn-sm pull-right" data-url="@Url.Action("DeclareActiveList", "DeclareMaterial",new { itemKey =DeclareKeys.ZisFaz_XuesHuod, declareTargetId=declareTargetId})" data-toggle="ajax-modal" data-target="#firstModal">
					历史库
				</a>
			}
		</div>
		<div class="widget-content">
			<div class="table-responsive">
				<table class="table table-condensed table-striped table-hover">
					<thead>
						<tr>
							<th class="width180">时间</th>
							<th class="width180">地点</th>
							<th class="width180">类型</th>
							<th class="width180">级别</th>
							<th style="width:500px">工作内容</th>
							<th class="width180">参加对象</th>
							<th class="width180">组织单位、部门/负责人</th>
							<th class="width400">操作</th>
						</tr>
					</thead>
					<tbody>
						@foreach (var item in pingbHuoj)
						{
							<tr>
								<td>@item.Date.ToString("yyyy-MM-dd")</td>
								<td>@item.Location</td>
								<td>@PicklistHelper.XuesHuodType.GetName(item.Dynamic9)</td>
								<td>@item.Level</td>
								<td>@item.ContentValue</td>
								<td>@item.Dynamic1</td>
								<td>@item.Dynamic2</td>
								<td>
									<div class="btn-group pull-right">
										<a class="btn btn-success btn-sm" data-url="@Url.Action("ZisFaz_XuesHuod", "DeclarePop",new {id=item.DeclareActiveId, declareTargetId=declareTargetId })" data-toggle="ajax-modal" data-target="#firstModal">编辑</a>
										<a target="_blank" class="btn btn-warning btn-sm  btn-cancelDeclare" data-url="@Url.Action("DeclareActive", "DeclareMaterial", new {id=item.DeclareActiveId, isDeclare=false, declareTargetId = declareTargetId })" href="#">取消申报</a>
										<button class="btn btn-danger btn-sm btn-view" data-toggle="ajax-modal" data-url="@Url.Action("AttachmentsView", "DeclarePop", new { id = item.DeclareActiveId, type = AttachmentsKeys.ZisFaz_XuesHuod })" data-target="#firstModal" title="查看附件">查看附件</button>
									</div>
								</td>
							</tr>
						}
					</tbody>
				</table>
			</div>
		</div>
	</div>
	<!-- END WIDGET TABBED CONTENT -->

	<div class="col-md-offset-5">
		<button class="btn btn-custom-primary btn-fake"><i class="fa fa-save"></i> 保存</button>
	</div>
</div>


@section Modals {
	<!-- Modal start -->
	<div class="modal" id="firstModal" tabindex="-1" role="dialog" aria-labelledby="firstModalLabel" aria-hidden="true">
	</div>
	<!-- Modal end -->
}
<script>
	function loadFrag(obj) {
		$.get('@Url.Action("Items", "DeclareMaterial")?declareTargetId=@declareTargetId&view=_items5005', function (html) {
			var tempTabId = '#tab1';
			var currentTabId = $('.nav').find('.active > a').attr('href');

			$('#tab2').remove();
			$('.items').append(html);
			$('a[href="' + tempTabId + '"]').tab('show');
			$('a[href="' + currentTabId + '"]').tab('show'); // TODO: update tab
		});

		$('#firstModal').modal('hide');
	}

	$(function () {

		$('.btn-declare,.btn-cancelDeclare').on('click', function (e) {
			e.preventDefault();

			var $this = $(this);
			var url = $this.data('url');

			$.post(url, null, function (data, status) {
				popupMessage(data, {
					success: function () {
						loadFrag($this, data);
					}
				});
			})
		});

		$('.btn-fake').on('click', function () {
			popupMessage({ result: '@AjaxResults.Success', msg: '保存成功！ ' })
		});
	});
</script>
